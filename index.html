<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112417989-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-112417989-2');
    </script>
    <title>COVID-19 Illinois</title>
    <meta charset="UTF-8">
    <meta name="description" content="COVID-19 metrics in Illinois state and counties. Updated daily. Data sourced from Illinois Department of Public Health.">
    <meta name="keywords" content="covid-19, coronavirus, illinois">
    <meta name="author" content="Matt Stypa">
    <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#333333">
    <meta name="theme-color" content="#333333">
    <meta name="viewport" content="width=device-width, initial-scale=0.7">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="data.js"></script>
    <style>
      body {
        margin: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 14px;
        background-color: #222;
        color: #CCC;
      }
      a, a:visited, a:active {
        color: #3DF;
      }
      small {
        font-size: 14px;
        color: #999;
      }
      .chart-container {
        height: calc(100vh - 300px);
        width: calc(100vw - 40px);
        max-height: calc(100vw);
        min-height: 300px;
      }
      button {
        border: 1px solid #999;
        color: #999;
        background: none;
        border-radius: 10px;
        user-select: none;
        display: inline-block;
        margin-right: 10px;
        margin-top: 10px;
        padding: 10px 20px;
        cursor: pointer;
      }
      button:focus {
        outline: none;
      }
      button.active {
        border-color: #3DF;
        color: #3DF;
        border-width: 3px;
        padding: 8px 18px;
      }
      button#cases-btn {
        border-radius: 10px 0 0 10px;
        margin-right: 0;
      }
      button#deaths-btn {
        border-radius: 0 10px 10px 0;
      }
      .message {
        margin: 50px 0;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <h1>COVID-19 Illinois</h1>
    <p>
      <small>Data source:</small> <a target="_blank" rel="noreferrer noopener" href="http://www.dph.illinois.gov/topics-services/diseases-and-conditions/diseases-a-z-list/coronavirus">Illinois Department of Public Health</a><br/>
      <small>Last updated on:</small> <span id="last-updated"></span>
    </p>
    <div class="chart-container">
        <canvas id="chart"></canvas>
    </div>
    <p id="legend-primary"></p>
    <p id="legend-secondary"></p>
    <p><small>âœ¸ Counties that we do not have data for or counties with no active cases have been ommitted.</small></p>
    <p class="message">
      Hello! ðŸ‘‹<br/>
      I make improvements and add new features everyday, but if you have an idea or suggestion let me know on twitter <a target="_blank" rel="noreferrer noopener" href="https://twitter.com/mattstypa">@mattstypa</a>.
    </p>
    <script>
      var primaryAreas = ['Illinois', 'Chicago', 'Tested'];
      var initialAreas = ['Illinois', 'Chicago'];
      var areas = Object.keys(data.sets).sort();
      var datasets = [];
      var lagendPrimary = [];
      var legendSecondary = [];

      areas.forEach(function(area, index) {
        var legend = { area: area, index: index };
        datasets.push(getDataSet(area, data.sets[area].positive, data.sets[area].color));
        includes(primaryAreas, area) ? lagendPrimary.push(legend) : legendSecondary.push(legend);
      });

      function getDataSet(area, data, color) {
        return {
          hidden: !includes(initialAreas, area),
          label: area,
          lineTension: 0,
          pointRadius: 5,
          pointHoverRadius: 5,
          pointHitRadius: 30,
          fill: false,
          spanGaps: true,
          borderColor: color,
          backgroundColor: color,
          data: data,
        };
      }

      document.getElementById('last-updated').innerHTML = data.updated;
      document.getElementById('legend-primary').innerHTML = lagendPrimary.map(renderLegendButton).join('');
      document.getElementById('legend-secondary').innerHTML = legendSecondary.map(renderLegendButton).join('');

      function renderLegendButton(legend) {
        var active = includes(initialAreas, legend.area) ? 'active' : '';
        return ['<button class="', active, '" data-index="', legend.index, '" onclick="toggleArea(this)">', legend.area, '</button>'].join('');
      }

      function toggleArea(el) {
        var active = !el.classList.contains('active');
        active ? el.classList.add('active') : el.classList.remove('active');
        myChart.data.datasets[el.dataset.index].hidden = !active;
        myChart.update();
      }

      function includes(arr, item) {
        return arr.indexOf(item) > -1;
      }

      var axes = [{
        gridLines: { color: '#444' },
        ticks: { fontColor: '#CCC' },
      }];

      var myChart = new Chart(document.getElementById('chart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: datasets,
        },
        plugins: [ChartDataLabels],
        options: {
          maintainAspectRatio: false,
          animation: false,
          legend: {
            display: false,
            position: 'bottom',
            labels: {
                boxWidth: 12,
                padding: 16,
                fontColor: '#CCC',
            },
          },
          scales: {
            xAxes: axes,
            yAxes: axes,
          },
          plugins: {
            datalabels: {
              align: 'left',
              offset: 8,
              borderRadius: 5,
              textStrokeWidth: 4,
              textStrokeColor: '#222',
              color: function(context) {
                return context.dataset.backgroundColor;
              },
              formatter: function(value, context){
                return context.dataset.data.length === context.dataIndex + 1 ? context.dataset.label : null;
              }
            }
          }
        },
      });
    </script>
  </body>
</html>
